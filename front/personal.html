<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MaxFit - Sistema para treinos</title>

    <!-- CSS -->
    <link rel="stylesheet" href="estilos.css">
</head>
<body>
    <!-- Cabeçalho -->
    <header>

        <!-- Título -->
        <h1>Max Fit</h1>
        <img src="imagens/logo.png" alt="Logo Max Fit">

        <!-- Menu -->
        <nav>
            <ul>
                <li><a href="#" onclick="sair()">Sair</a></li>
            </ul>
        </nav>

    </header>

    <!-- Principal -->
<!-- Principal -->
<main>
  <section>
    <h2 id="boasVindas"></h2>
    <p>Área do personal.</p>
  </section>

  <!-- Formulário de cadastro de treino -->
  <section>
    <h3>Cadastrar Treino</h3>
    <form id="formTreino">
      <label for="aluno">Selecione o Aluno:</label><br>
      <select id="aluno" name="aluno" required>
        <option value="">Carregando alunos...</option>
      </select><br><br>

      <label for="instrutor">Nome do Instrutor:</label><br>
      <input type="text" id="instrutor" name="instrutor" required><br><br>

      <label for="descricao">Descrição do treino:</label><br>
      <textarea id="descricao" name="descricao" rows="4" cols="40" required></textarea><br><br>

      <div>
        <button type="submit">Cadastrar Treino</button>
      </div>
    </form>
  </section>

  <!-- Lista de treinos -->
  <section>
    <h3>Lista de Treinos</h3>
    <ul id="listaTreinos"></ul>
  </section>
</main>

<!-- Script -->
<script>
  const API_TREINOS = "https://maxfit-v0z3.onrender.com/treinos";
  const API_ALUNOS = "https://maxfit-v0z3.onrender.com/alunos";

  // Obter dados do LocalStorage
  const obj = localStorage.getItem("usuario");
  if (!obj) window.location.href = "index.html";

  const usuario = JSON.parse(obj);

  // Exibir mensagem de boas-vindas
  document.getElementById("boasVindas").innerText = `Seja bem-vindo(a) ${usuario.nome}`;

  // Referências
  const formTreino = document.getElementById("formTreino");
  const listaTreinos = document.getElementById("listaTreinos");
  const selectAlunos = document.getElementById("aluno");

  // === Carregar alunos para o select ===
  async function carregarAlunos() {
    try {
      const resposta = await fetch(API_ALUNOS);
      const alunos = await resposta.json();

      if (alunos.length === 0) {
        selectAlunos.innerHTML = `<option value="">Nenhum aluno cadastrado</option>`;
        return;
      }

      selectAlunos.innerHTML = `<option value="">Selecione um aluno</option>`;
      alunos.forEach(aluno => {
        const option = document.createElement("option");
        option.value = aluno.nome;
        option.textContent = aluno.nome;
        selectAlunos.appendChild(option);
      });
    } catch (erro) {
      console.error("Erro ao carregar alunos:", erro);
      selectAlunos.innerHTML = `<option value="">Erro ao carregar alunos</option>`;
    }
  }

  // === Carregar treinos ===
  async function carregarTreinos() {
    listaTreinos.innerHTML = "<li>Carregando...</li>";
    try {
      const resposta = await fetch(API_TREINOS);
      const treinos = await resposta.json();

      if (treinos.length === 0) {
        listaTreinos.innerHTML = "<li>Nenhum treino cadastrado.</li>";
        return;
      }

      listaTreinos.innerHTML = "";
      treinos.forEach(treino => {
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>Aluno:</strong> ${treino.aluno} <br>
          <strong>Instrutor:</strong> ${treino.instrutor} <br>
          <strong>Descrição:</strong> ${treino.descricao} <br>
          <button onclick="removerTreino('${treino.id}')">Remover</button>
        `;
        listaTreinos.appendChild(li);
      });
    } catch (erro) {
      console.error("Erro ao carregar treinos:", erro);
      listaTreinos.innerHTML = "<li>Erro ao carregar treinos.</li>";
    }
  }

  // === Cadastrar treino ===
  formTreino.addEventListener("submit", async (e) => {
    e.preventDefault();

    const novoTreino = {
      aluno: selectAlunos.value,
      instrutor: document.getElementById("instrutor").value,
      descricao: document.getElementById("descricao").value
    };

    if (!novoTreino.aluno) {
      alert("Selecione um aluno!");
      return;
    }

    try {
      const resposta = await fetch(API_TREINOS, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(novoTreino)
      });

      if (resposta.ok) {
        alert("Treino cadastrado com sucesso!");
        formTreino.reset();
        carregarTreinos();
      } else {
        alert("Erro ao cadastrar treino.");
      }
    } catch (erro) {
      console.error(erro);
      alert("Erro de conexão com a API.");
    }
  });

  // === Remover treino ===
  async function removerTreino(id) {
    if (!confirm("Deseja realmente remover este treino?")) return;

    try {
      const resposta = await fetch(`${API_TREINOS}/${id}`, { method: "DELETE" });
      if (resposta.ok) {
        alert("Treino removido com sucesso!");
        carregarTreinos();
      } else {
        alert("Erro ao remover treino.");
      }
    } catch (erro) {
      console.error(erro);
      alert("Erro de conexão com a API.");
    }
  }

  window.removerTreino = removerTreino;

  // === Inicialização ===
  carregarAlunos();
  carregarTreinos();

  // === Sair ===
  const sair = () => {
    localStorage.removeItem("usuario");
    window.location.href = "index.html";
  };
</script>

</body>
</html>